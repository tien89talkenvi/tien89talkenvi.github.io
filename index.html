<!DOCTYPE html>
<html>
<head>
    <title>Speech to Text</title>
</head>
<body>
    <button id="startButton1">Say in Vietnamese</button>
    <button id="startButton2">Say in English</button>
    <br><br>

    <div class="text-input">
        <textarea spellcheck="false" readonly disabled class="text-noi" placeholder="Noi"></textarea>
        <textarea spellcheck="false" readonly disabled class="text-dich" placeholder="Dich"></textarea>
    </div>

    <p id="result"></p>
    <script>
        //Khoi dong
        
        const startButton1 = document.getElementById('startButton1');
        const startButton2 = document.getElementById('startButton2');
        const resultElement = document.getElementById('result');
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.msSpeechRecognition)();

        // KHI CLICK startButton1:
        //recognition.lang = 'vi-VN'; // Thiết lập ngôn ngữ là tiếng Việt cho nguoi noi khi click nut co id startButton1
        startButton1.addEventListener('click', () => {
            recognition.lang = 'vi-VN'; // Thiết lập ngôn ngữ là tiếng Việt
            const fromText = document.querySelector(".text-noi"),
            toText = document.querySelector(".text-dich");

            recognition.start();

            recognition.onresult = (event) => {
                const resultnoi = event.results[0][0].transcript;
                //resultElement.textContent = '' + result;
                fromText.setAttribute("placeholder", resultnoi);
                vi_dichra_en(resultnoi);

            };

            recognition.onend = () => {
                startButton1.disabled = false;
            };
        });

        // KHI CLICK startButton2:
        //recognition.lang = 'vi-VN'; // Thiết lập ngôn ngữ là tiếng Việt cho nguoi noi khi click nut co id startButton1
        startButton2.addEventListener('click', () => {
            recognition.lang = 'en-US'; // Thiết lập ngôn ngữ là tiếng Việt
            const fromText = document.querySelector(".text-noi"),
            toText = document.querySelector(".text-dich");

            recognition.start();

            recognition.onresult = (event) => {
                const resultnoi = event.results[0][0].transcript;
                //resultElement.textContent = '' + result;
                fromText.setAttribute("placeholder", resultnoi);
                en_dichra_vi(resultnoi);

            };

            recognition.onend = () => {
                startButton1.disabled = false;
            };
        });



</script>

<script>
function vi_dichra_en(text_dem_dich){
    //alert('vao ham dich_ra_english')
    const fromText = document.querySelector(".text-noi"),
    toText = document.querySelector(".text-dich");

    let text = text_dem_dich.trim(),
    //translateFrom = selectTag[0].value,
    //translateTo = selectTag[1].value;
    translateFrom = 'vi-VN',
    translateTo = 'en-US';
    //alert(text)

    if(!text) return;
    toText.setAttribute("placeholder", "Translating...");
    let apiUrl = `https://api.mymemory.translated.net/get?q=${text}&langpair=${translateFrom}|${translateTo}`;
    fetch(apiUrl).then(res => res.json()).then(data => {
        toText.value = data.responseData.translatedText;
        data.matches.forEach(data => {
            if(data.id === 0) {
                toText.value = data.translation;
                //alert(data.translation)

            }
        });
        toText.setAttribute("placeholder", toText.value);
    });

}
</script>

<script>
    function en_dichra_vi(text_dem_dich){
        //alert('vao ham dich_ra_english')
        const fromText = document.querySelector(".text-noi"),
        toText = document.querySelector(".text-dich");
    
        let text = text_dem_dich.trim(),
        //translateFrom = selectTag[0].value,
        //translateTo = selectTag[1].value;
        translateFrom = 'en-US',
        translateTo = 'vi-VN';
        //alert(text)
    
        if(!text) return;
        toText.setAttribute("placeholder", "Translating...");
        let apiUrl = `https://api.mymemory.translated.net/get?q=${text}&langpair=${translateFrom}|${translateTo}`;
        fetch(apiUrl).then(res => res.json()).then(data => {
            toText.value = data.responseData.translatedText;
            data.matches.forEach(data => {
                if(data.id === 0) {
                    toText.value = data.translation;
                    //alert(data.translation)
    
                }
            });
            toText.setAttribute("placeholder", toText.value);
        });
    
    }
</script>
    
    </body>
</html>
