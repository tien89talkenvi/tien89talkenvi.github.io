<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <title>Talkenvi</title>
    
<style>
  /*<link rel="stylesheet" href="z10.css"> */

:root{
    --mau-f-grid-col: rgba(184,245,114,0.883);
}
*{
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
}
.fixed-header{
    /* min-height: 33vh;
    width: 100%;
    background: linear-gradient(to bottom right, green, rgba(74, 207, 136));
    background-position: center ;
    background-size: cover;
    position: fixed;        */
    
    top: 0;
    width: 100%;
    position: fixed;        
    background-color:rgb(47, 155, 97);
    padding: 15px 0;

    
}
.strCuon{
    color:white;
    text-align:center;
}
.tenbai{
    color:yellow;
    text-align:center;
}
#circlein {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    margin: auto;
    box-shadow: 1px 1px 15px lightblue;
    } 
.mic-icon {
    height: 24px;
    position: center;
    margin-top:4px;
    margin-left:3px;
}
.mic-iconub {
    height: 24px;
    /* position: center; */
    margin-top:4px;
    margin-left:3px;
}
#words{
    color:yellow;
    text-align:center;
}
nav{
    display: flex;
    /* display: inline; */
    padding: auto;
    justify-content: space-between;
    align-items: top;
    color:brown;
    margin-left: 5%;
    margin-right: 5%;

} 
p{
    color: brown;
    font-weight: 300;
    line-height: 22px;
    padding: 10px ;
}
.text-input{
    text-align:center;
}
.cangiua-divActive{
    text-align: center;
}
p {font-size: 14pt;}
.f-grid {
    display: flex;
    justify-content: space-between;
    margin-left:-0.5rem;
    flex-flow: row wrap;}
.f-grid-col {
    flex: 3 0;
    background-color: var(--mau-f-grid-col);
    margin-left: 0.5rem;
    margin-bottom: 1rem;
    padding: 1rem;
    font-size: 13pt;}
.f-grid-colkhac{
    flex: 3 0;
    background-color: rgba(230, 208, 224, 0.883);
    margin-left: 0.5rem;
    margin-bottom: 1rem;
    padding: 1rem;
    font-size: 13pt;}
.f-grid-1dong{
    background-color: rgb(147, 147, 224);
    color:yellow;
    text-align: center;

}
  /* #user-icon:hover, #robot-icon:hover{
    opacity: 1.0;  
    filter: alpha(opacity=100);
  }   */
  #setlang-icon{
    height: 40px;
    width: 40px;
    border-radius: 50%;
    border: none;
  }
textarea {
    font-size: 18px;
    line-height: 1.5;
    resize: none;
}
    body{
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 10px;
      min-height: 100vh;
      background: hsl(128, 39%, 36%);
    }

</style>

</head>
<body>
<header class="fixed-header">
    <div class="tenbai";>
        <br>
        <label for="unit_1"><image src="./icons/setting.png" id="setlang-icon"/>Talk in language : </label>
        <select name="chonunit1" id="unit_1">
            <option value="vi" selected>Vietnamese (Việt)</option>
            <option value="en">English (Anh)</option>
            <option value="es">Spanish (Mexico)</option>
            <option value="zh-TW">Taiwan (Đài loan)</option>
            <option value="da">Danish (Đan mạch)</option>
            <option value="de">German (Đức)</option>
            <option value="nl">Dutch (Hà lan)</option>
            <option value="fr">French (Pháp)</option>
            <option value="ja">Japanese (Nhật)</option>
            <option value="ko">Korean (Hàn)</option>
            <option value="th">Thai (Thái)</option>
            <option value="km">Khmer (Miên)</option>
            <option value="lo">Lao (Lào)</option>
        </select>&ensp; and &ensp; 
                  
        <select name="chonunit2" id="unit_2">
            <option value="vi" >Vietnamese (Việt)</option>
            <option value="en" selected>English (Anh)</option>
            <option value="es">Spanish (Mexico)</option>
            <option value="zh-TW">Taiwan (Đài loan)</option>
            <option value="da">Danish (Đan mạch)</option>
            <option value="de">German (Đức)</option>
            <option value="nl">Dutch (Hà lan)</option>
            <option value="fr">French (Pháp)</option>
            <option value="ja">Japanese (Nhật)</option>
            <option value="ko">Korean (Hàn)</option>
            <option value="th">Thai (Thái)</option>
            <option value="km">Khmer (Miên)</option>
            <option value="lo">Lao (Lào)</option>
        </select>
        <a>&ensp;</a>
        
    </div>
    <br>

    <div class="button" id="circlein" onclick="userSpeechToText()">
        <img src="https://cdn1.iconfinder.com/data/icons/google-s-logo/150/Google_Icons-25-512.png" alt="mic-icon" class="mic-icon"/>
    </div>
    <br>
    <nav>
        <p>Chọn một ngôn ngữ để nói :</p>
        <input type="radio" name="gender" id="radio1" value="vi" checked />
        <label for="radio1">vi</label>
        <input type="radio" name="gender" id="radio2" value="en" />
        <label for="radio2">en</label>
    </nav>
    <br>
    <hr>
    <p id="words"></p>
    <div class="text-input">
        <textarea id="txt-noi" name="txtnoi" spellcheck="false" readonly disabled class="from-text" placeholder="Speaked text" rows="4" cols="50"></textarea>
        <textarea id="txt-dich" name="txtdich" spellcheck="false" readonly disabled class="to-text" placeholder="Translation" rows="4" cols="50"></textarea>
    </div>
</header>
<br>
  
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<div id="divActive" class="cangiua-divActive">
<br><br><br><br><br><br><br><br<br><br><br><br><br><br><br<br><br><br><br><br>
<br><br><br><br><br><br><br>
    <audio controls autoplay>
        <source src="my_audio.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    

</div>

<script>
//<script src="z10.js" >
//---------cac bien global ---------
//var lang_noi='vi'; 
//var lang_dich='en'; 


//---global neu co su thay doi unit thi ham nay chay----------------------
var uchon1 = document.getElementById("unit_1");
var radioBtn1 = document.getElementById('radio1'); 
var label1 = document.querySelector("label[for='radio1']");

var uchon2 = document.getElementById("unit_2");
var radioBtn2 = document.getElementById('radio2'); 
var label2 = document.querySelector("label[for='radio2']"); 

const fromText = document.querySelector(".from-text"),
toText = document.querySelector(".to-text");


uchon1.onchange=function(){
    label1.textContent=(this.value);
    document.querySelector("#circlein").style.backgroundColor = null;
    fromText.textContent = "";
    toText.textContent = "";

};
radioBtn1.addEventListener('change', (event) => { 
    document.querySelector("#circlein").style.backgroundColor = null;
    fromText.textContent = "";
    toText.textContent = "";

});    


uchon2.onchange=function(){
    label2.textContent=(this.value);
    document.querySelector("#circlein").style.backgroundColor = null;
    fromText.textContent = "";
    toText.textContent = "";
};

radioBtn2.addEventListener('change', (event) => { 
    document.querySelector("#circlein").style.backgroundColor = null;
    fromText.textContent = "";
    toText.textContent = "";
});    

//------------Recognition----------
function userSpeechToText(){
    if (radioBtn1.checked) {
        from_l1=label1.textContent;
    }else{
        from_l1=label2.textContent;
    }
    var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
    var recognition = new SpeechRecognition();
    recognition.lang = from_l1;
    recognition.interimResults = false;

    recognition.start();
    fromText.textContent = "";
    document.querySelector("#circlein").style.backgroundColor = "#6BD6E1";

    recognition.onresult = function(event) {
        var lastResult = event.results.length - 1;
        var content = event.results[lastResult][0].transcript;
        fromText.textContent = content;
        recognition.stop();
        document.querySelector("#circlein").style.backgroundColor = null;
        translate_froml1_tol2()
        //alert(textnoi);
    };
    
//    recognition.onspeechend = function() {
//        recognition.stop();
//        document.querySelector("#circlein").style.backgroundColor = null;
//        };
    
    recognition.onerror = function(event) {
        document.querySelector('#words').textContent = 'Error occurred in recognition: ' + event.error;
        document.querySelector("#circlein").style.backgroundColor = null
        }
    };
//-----------------------
function translate_froml1_tol2(){
    let text = fromText.value;
    if (radioBtn1.checked) {
        translateFrom=label1.textContent;
        translateTo=label2.textContent;
    }else{
        translateFrom=label2.textContent;
        translateTo=label1.textContent;
    }
    if(!text) return;
    toText.setAttribute("placeholder", "Translating...");
    let apiUrl = `https://api.mymemory.translated.net/get?q=${text}&langpair=${translateFrom}|${translateTo}`;
    fetch(apiUrl).then(res => res.json()).then(data => {
        toText.value = data.responseData.translatedText;
        data.matches.forEach(data => {
            if(data.id === 0) {
                toText.value = data.translation;
                txtdich_to_audio()
            }
        });
        toText.setAttribute("placeholder", "Translation");
    });
}
//-----------ham chinh ---
document.getElementById('speak-icon').style.opacity = .7;
document.getElementById('speak-icon').style.filter= "alpha(opacity=50)";
document.getElementById("circlein").style.display = "none";
//api key for chatbot python 29-12-22
//6872f5ecb8f26fe4bb0bd2cb0945ed08364d984f
</script>

</body> 
</html>
